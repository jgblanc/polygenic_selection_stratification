---
title: "InUKBB"
author: "Jennifer Blanc"
date: "2024-08-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(data.table)
```

## Read in GWAS IDs

```{r}
dfe5 <- fread("../data/ids/gwas_ids/e5.txt")
dfe10 <- fread("../data/ids/gwas_ids/e10.txt")
dfe50 <- fread("../data/ids/gwas_ids/e50.txt")
dfe200 <- fread("../data/ids/gwas_ids/e200.txt")

dfGWAS <- rbind(dfe5, dfe10, dfe50, dfe200)
```

## Country of Birth UK

```{r}
dfCoBUK <- fread("../data/InUKBB/data/CountryOfBirthUK_1647.txt")
dfCoBUK <- dfCoBUK %>% filter(CountryOfBirthUK_1647 > 0) %>% 
  mutate(CoB = case_when(CountryOfBirthUK_1647 == 1 ~ "England",
                         CountryOfBirthUK_1647 == 2 ~ "Wales",
                         CountryOfBirthUK_1647 == 3 ~ "Scotland",
                         CountryOfBirthUK_1647 == 4 ~ "NorthernIreland", 
                         CountryOfBirthUK_1647 == 5 ~ "RepublicOfIrelend", 
                         CountryOfBirthUK_1647 == 6 ~ "Elsewhere"))

dfCoBUK <- inner_join(dfCoBUK, df)%>% filter(continental == "Europe")
```

## Make test panel 

```{r}
dfTest <- dfCoBUK %>% filter(! IID %in% dfGWAS$IID)  %>% mutate("POP" = CoB) %>% select("#FID", "IID", "POP") %>% filter(POP != "Elsewhere")

fwrite(dfTest,"../data/InUKBB/ids/test_ids/CountryOfBirthUK.txt", row.names = F, col.names = T, quote = F, sep = "\t")

table(dfTest$POP)
```
## Result

Load data and format 
```{r}
dfOverlap <- fread("../endpoints/InUKBB/OverlapStats.txt") %>% separate(gwas, into = c("tmp", "gwas"), sep = "e")
dfOverlap$gwas <- factor(dfOverlap$gwas, levels = c( "5", "10", "50", "200")) 
```

```{r}
dfPC <- fread("../endpoints/InUKBB/PCStats.txt") %>% separate(gwas, into = c("tmp", "gwas"), sep = "e")
dfPC$gwas <- factor(dfPC$gwas, levels = c("e5", "e10", "e50", "e200"))
```

```{r}
pl <- dfOverlap %>% filter(L == "pruneall")%>% ggplot(aes(x = gwas, y = Z)) + geom_point() + xlab("") + ylab("") + theme_bw(base_size = 14)  + guides(fill="none") + theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(size = 10), strip.text.x = element_text(size = 6,))+facet_wrap(~contrasts, nrow = 1)+ scale_y_log10(breaks = c(1e-5, 1e-4, 1e-3), limits = c(1e-5, 1e-3)) 
pl
ggsave("~/Desktop/tmp.png", pl, height = 2, width = 12)
```


