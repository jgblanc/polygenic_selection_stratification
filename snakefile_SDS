# Snakefile to do the pre-data processing Singleton Density Scores in UK10K and
CHR = []
for i in range(1, 23):
  CHR.append(str(i))
CONTRASTS = ["Han", "UK10K"]
GWAS=["ALL", "WBS", "q1", "q2", "q3", "q4"]

rule all:
    input:
        expand("data/SDS/r/{gwas}/Han_chr{chr}.rvec", chr=CHR, gwas=GWAS, contrasts=CONTRASTS)

# Process and match UK10K SNPs

rule flip_all_snps:
    input:
        gwas_freq="data/ukbb/variantFreq/{gwas}_{chr}.afreq",
	      sds="data/SDS/raw/SDS_UK10K_n3195_release_Sep_19_2016.tab.gz"
    output:
        rvec="data/SDS/r/{gwas}/UK10K_chr{chr}.rvec",
        overlappingSNPs="data/SDS/variants/{gwas}/UK10K/overlappingSNPs_chr{chr}.txt"
    shell:
        """
        Rscript code/sds/flip_overlapping_snps.R {input.gwas_freq} {input.sds} {output.rvec} {output.overlappingSNPs}
        """

# Process and match Han SNPs

rule liftover_snps:
    input:
        gwas_freq="data/ukbb/variantFreq/{gwas}_{chr}.afreq",
	      sds="data/SDS/raw/Han_SDS_liftedover.txt.gz"
    output:
        rvec="data/SDS/r/{gwas}/Han_chr{chr}.rvec",
        overlappingSNPs="data/SDS/variants/{gwas}/Han/overlappingSNPs_chr{chr}.txt"
    shell:
        """
        Rscript code/sds/liftover_snps.R {input.gwas_freq} {input.sds} {output.rvec} {output.overlappingSNPs}
        """
